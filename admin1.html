<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Admin Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; padding: 20px; }
        input, select, textarea { width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: #fff; border-radius: 8px; margin-bottom: 10px; font-family: inherit; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .gold { color: #D4AF37; }
        .btn-gold { background: #D4AF37; color: #000; }
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #admin-screen { display: none; }
        .item-row { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #333; }
        #upload-status { font-size: 12px; color: yellow; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

    <!-- GİRİŞ (SADECE ŞİFRE) -->
    <div id="login-screen">
        <h2 class="gold">YÖNETİCİ GİRİŞİ</h2>
        <input type="password" id="password" placeholder="Şifre" style="text-align:center; font-size:18px; letter-spacing: 3px;">
        <button class="btn-gold" onclick="checkLogin()">GİRİŞ YAP</button>
        <p id="login-msg" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>

    <!-- PANEL -->
    <div id="admin-screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 class="gold" style="margin:0;">PANEL</h2>
            <button style="width:auto; background:#333; color:#fff;" onclick="location.reload()">ÇIKIŞ</button>
        </div>

        <button onclick="uploadFullMenu()" style="background:#222; color:#888; border:1px dashed #555; margin-bottom:20px;">⚠️ Menüyü Sıfırla ve Yükle</button>

        <div style="background:#111; padding:20px; border-radius:10px; border:1px solid #333; margin-bottom:20px;">
            <h4 style="margin-top:0; color:#fff;">Ürün Ekle / Düzenle</h4>
            <input type="hidden" id="pid">
            <input type="text" id="pname" placeholder="Ürün Adı">
            <input type="text" id="pdesc" placeholder="Açıklama (İçerik)">
            <input type="number" id="pprice" placeholder="Fiyat">
            
            <label style="font-size:12px; color:#888;">Görsel Yükle:</label>
            <input type="file" id="pfile" accept="image/*">
            <span id="upload-status"></span>
            <input type="hidden" id="pimg_url"> 

            <select id="pcat">
                <option value="Kampanya">Kampanyalar</option>
                <option value="Kahvaltı">Kahvaltı</option>
                <option value="Yemek">Yemekler</option>
                <option value="Atıştırmalık">Atıştırmalık</option>
                <option value="Sıcak">Sıcaklar</option>
                <option value="Soğuk">Soğuklar</option>
                <option value="Tatlı">Tatlılar</option>
                <option value="Nargile">Nargileler</option>
            </select>
            
            <select id="pbadge">
                <option value="">Rozet Yok</option>
                <option value="firsat">FIRSAT</option>
                <option value="yeni">YENİ</option>
                <option value="sef">ŞEFİN SEÇİMİ</option>
                <option value="aci">ACILI</option>
            </select>

            <button class="btn-gold" id="saveBtn" onclick="saveProduct()">KAYDET</button>
            <button onclick="resetForm()" style="background:transparent; color:#888; margin-top:5px;">Temizle</button>
        </div>

        <div id="list"></div>
    </div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        // SENİN KODLARIN
        const firebaseConfig = {
          apiKey: "AIzaSyB_T5V_iJ6ZKDj0k4XQ9hmKiHVR-umb5ho",
          authDomain: "ragbet-cafe26.firebaseapp.com",
          databaseURL: "https://ragbet-cafe26-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "ragbet-cafe26",
          storageBucket: "ragbet-cafe26.firebasestorage.app",
          messagingSenderId: "193248316486",
          appId: "1:193248316486:web:d6d4647afc16c30bfa0e47",
          measurementId: "G-1T7K39ME7L"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const storage = firebase.storage();
        let products = [];

        // --- GİRİŞ KONTROLÜ ---
        function checkLogin() {
            const pass = document.getElementById('password').value;
            // Şifre kontrolü (KOD İÇİNDE GÖMÜLÜ)
            if(pass === "rağbet3026") { // ŞİFRE BURADA
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-screen').style.display = 'block';
                loadData();
            } else {
                document.getElementById('login-msg').innerText = "Hatalı Şifre!";
            }
        }

        function loadData() {
            db.ref('menu').on('value', (snapshot) => {
                const data = snapshot.val();
                products = [];
                if(data) {
                    Object.keys(data).forEach(key => {
                        products.push({ ...data[key], id: key });
                    });
                }
                renderList();
            });
        }

        function renderList() {
            const list = document.getElementById('list');
            list.innerHTML = '';
            // Ters çevirip (en son eklenen en üstte) listele
            [...products].reverse().forEach(p => {
                list.innerHTML += `
                <div class="item-row">
                    <div>
                        <strong>${p.name}</strong><br>
                        <small style="color:#888">${p.cat} - ${p.price}₺</small>
                    </div>
                    <div>
                        <button style="background:#3498db; color:white; width:auto; padding:5px 10px;" onclick="editItem('${p.id}')">DÜZENLE</button>
                        <button style="background:#e74c3c; color:white; width:auto; padding:5px 10px;" onclick="delItem('${p.id}')">SİL</button>
                    </div>
                </div>`;
            });
        }

        function saveProduct() {
            const btn = document.getElementById('saveBtn');
            const status = document.getElementById('upload-status');
            const id = document.getElementById('pid').value;
            
            const file = document.getElementById('pfile').files[0];
            let imgUrl = document.getElementById('pimg_url').value;

            if(!document.getElementById('pname').value || !document.getElementById('pprice').value) {
                alert("Ad ve Fiyat zorunlu!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "İşleniyor...";

            // Resmi yükle ve kaydet fonksiyonunu çağır
            if (file) {
                status.innerText = "Resim yükleniyor...";
                const ref = storage.ref('urunler/' + Date.now() + '_' + file.name);
                ref.put(file).then(snapshot => {
                    return snapshot.ref.getDownloadURL();
                }).then(url => {
                    imgUrl = url;
                    status.innerText = "Yüklendi!";
                    saveToDb(id, imgUrl);
                }).catch(error => {
                    alert("Resim yükleme hatası: " + error.message);
                    btn.disabled = false;
                    btn.innerText = "KAYDET";
                });
            } else {
                saveToDb(id, imgUrl);
            }
        }

        function saveToDb(id, imgUrl) {
            const data = {
                name: document.getElementById('pname').value,
                desc: document.getElementById('pdesc').value,
                price: parseFloat(document.getElementById('pprice').value),
                cat: document.getElementById('pcat').value,
                badge: document.getElementById('pbadge').value,
                img: imgUrl
            };

            if(id) db.ref('menu/'+id).update(data);
            else db.ref('menu').push(data);
            
            resetForm();
            document.getElementById('saveBtn').disabled = false;
            document.getElementById('saveBtn').innerText = "KAYDET";
            alert("Kaydedildi!");
        }

        function delItem(id) {
            if(confirm("Silinsin mi?")) db.ref('menu/'+id).remove();
        }

        function editItem(id) {
            const p = products.find(x => x.id == id);
            document.getElementById('pid').value = p.id;
            document.getElementById('pname').value = p.name;
            document.getElementById('pdesc').value = p.desc;
            document.getElementById('pprice').value = p.price;
            document.getElementById('pcat').value = p.cat;
            document.getElementById('pbadge').value = p.badge;
            document.getElementById('pimg_url').value = p.img || '';
            document.getElementById('upload-status').innerText = p.img ? "Resim mevcut" : "";
            window.scrollTo(0,0);
        }

        function resetForm() {
            document.getElementById('pid').value = '';
            document.getElementById('pname').value = '';
            document.getElementById('pdesc').value = '';
            document.getElementById('pprice').value = '';
            document.getElementById('pimg_url').value = '';
            document.getElementById('pfile').value = '';
            document.getElementById('pbadge').value = '';
            document.getElementById('upload-status').innerText = '';
        }

        function uploadFullMenu() {
            if(!confirm("Tüm veriler silinip PDF verileri yüklenecek?")) return;
            db.ref('menu').remove();

            const pdfData = [
                {name: "Sen Seç Pizza + Kola", desc: "Karışık Pizza", price: 235, cat: "Kampanya", badge: "firsat"},
                {name: "Sen Seç Hamburger + Kola", desc: "Hamburger Menü", price: 195, cat: "Kampanya", badge: "firsat"},
                {name: "Sen Seç Tavuk Wrap + Kola", desc: "", price: 190, cat: "Kampanya", badge: ""},
                {name: "Kış Kampanyası", desc: "Sufle + Türk Kahvesi", price: 150, cat: "Kampanya", badge: "yeni"},
                {name: "Tatlı Sizden Kahve Bizden", desc: "Magnolya + Filtre Kahve", price: 145, cat: "Kampanya", badge: ""},
                {name: "Nargile Kampanyası", desc: "Nargile + Çerez + İçecek", price: 525, cat: "Kampanya", badge: "firsat"},
                {name: "Serpme Kahvaltı", desc: "Min 2 Kişilik", price: 400, cat: "Kahvaltı", badge: "sef"},
                {name: "Güveç Kahvaltı", desc: "Tek kişilik", price: 200, cat: "Kahvaltı", badge: ""},
                {name: "Rağbet Menemen", desc: "Sucuk, salam, kaşar", price: 100, cat: "Kahvaltı", badge: "aci"},
                {name: "Hamburger", desc: "140gr köfte", price: 165, cat: "Yemek"},
                {name: "Tavuk Burger", desc: "130gr tavuk", price: 155, cat: "Yemek"},
                {name: "Karışık Tost", desc: "", price: 125, cat: "Atıştırmalık"},
                {name: "Atıştırmalık Tabağı", desc: "", price: 150, cat: "Atıştırmalık"},
                {name: "Türk Kahvesi", desc: "", price: 55, cat: "Sıcak"},
                {name: "Çay", desc: "", price: 18, cat: "Sıcak"},
                {name: "Coca Cola", desc: "", price: 45, cat: "Soğuk"},
                {name: "Milkshake", desc: "", price: 95, cat: "Soğuk"},
                {name: "Sufle", desc: "", price: 105, cat: "Tatlı", badge: "yeni"},
                {name: "Magnolya", desc: "", price: 90, cat: "Tatlı", badge: ""},
                {name: "Love 66", desc: "Adalya", price: 200, cat: "Nargile", badge: "sef"},
                {name: "Lady Killer", desc: "Adalya", price: 200, cat: "Nargile", badge: ""}
            ];

            pdfData.forEach(d => db.ref('menu').push(d));
            alert("Yüklendi!");
        }
    </script>
</body>
</html>


